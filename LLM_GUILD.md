# LLM 입력 분류 및 프롬프트 생성 가이드

## 1. 입력 분류(classifyInput)

### 분류 목적
- 사용자의 입력 의도를 파악하여 적절한 LLM 프롬프트 및 처리 로직을 선택

### 분류 방식
1. **LLM 기반 사전 분류**
   - systemPrompt로 분류 기준을 LLM에 명확히 안내
   - LLM이 "NEW_SOURCE", "RAG_QUESTION", "GENERAL_QUESTION" 중 하나의 토큰만 반환하도록 강제
   - 예시 systemPrompt:
     ```
     당신은 입력의 의도를 분류하는 분류기입니다.
     아래 세 가지 중 하나만 출력하세요. 다른 말은 절대 하지 마세요.
     NEW_SOURCE  |  RAG_QUESTION  |  GENERAL_QUESTION
     ...
     ```
   - LLM 응답이 없거나 실패 시 휴리스틱(키워드/패턴) 분류로 폴백

2. **휴리스틱(키워드/패턴) 분류**
   - 파일 경로/위치 질문, 코드베이스 관련 질문, 일반 질문 등으로 분류
   - 주요 키워드/패턴:
     - 파일/경로/위치 관련: "경로 알려", "파일 위치", "file path" 등
     - 코드베이스 관련: "어떻게", "함수", "클래스", "구현", "코드", "프로젝트" 등
     - 질문형 패턴: "?", "어떻게", "how" 등
   - 코드베이스 관련 키워드 또는 질문형 패턴이 있으면 RAG_QUESTION, 아니면 GENERAL_QUESTION

### 분류 결과 (UserInputType)
- NEW_SOURCE: 새 파일/클래스/함수/컴포넌트 생성, 새로운 기능 추가 요청
- RAG_QUESTION: 프로젝트 코드/파일/함수/경로/구현에 대한 질문
- GENERAL_QUESTION: 일반 지식/조언/설명 등


## 2. 프롬프트 생성 로직

### 분류별 프롬프트 특징

#### 1) NEW_SOURCE
- (코드 생성/삽입 요청) 관련 코드 컨텍스트와 함께, 신규 소스 작성 지시
- 예시 프롬프트:
  - "아래 제공된 프로젝트 코드 컨텍스트와 사용자 질문을 바탕으로 신규 소스를 작성하세요."
  - 관련 코드 청크(최대 5개)와 선택 코드 컨텍스트 포함

#### 2) RAG_QUESTION
- (코드 기반 질의응답) 프로젝트 코드에서 관련 코드 청크(최대 5개)를 추출하여 컨텍스트로 제공
- 프롬프트 템플릿:
  - "아래 제공된 프로젝트 코드 컨텍스트와 사용자 질문을 바탕으로 답변하세요. 출력은 반드시 다음 Markdown 템플릿만 사용합니다."
  - ✅ 질문 요약 : {사용자 질문 요점}
  - ✅ 응답 : {응답 내용 (1000자 이내 요약, 정리)}
  - ✅ 출처 : {출처 (파일명, 라인 위치)}
  - 규칙: 한국어, 요약, 출처 명시 등

#### 3) GENERAL_QUESTION
- (일반 질의응답) 코드 컨텍스트 없이 일반 지식/조언/설명 요청
- 프롬프트 템플릿:
  - "아래 제공된 컨텍스트와 사용자 질문을 바탕으로 답변하세요. 출력은 반드시 다음 Markdown 템플릿만 사용합니다."
  - ✅ 질문 요약 : {사용자 질문 요점}
  - ✅ 응답 : {응답 내용 (1000자 이내 요약, 정리)}
  - ✅ 출처 : {출처 (파일명, 라인 위치) 또는 '해당 없음'}
  - 규칙: 한국어, 요약, 출처 명시 등


## 3. 요약
- 입력 분류(classifyInput)는 LLM+휴리스틱 방식으로 의도를 판별
- 분류 결과에 따라 RAG 기반 코드 컨텍스트, 신규 소스 생성, 일반 Q&A 등 맞춤형 프롬프트를 생성
- 모든 프롬프트는 Markdown 템플릿, 요약, 출처 명시 등 일관된 규칙을 따름

---

(이 가이드는 ChatService.kt 기준 자동화된 분석 결과입니다.)


