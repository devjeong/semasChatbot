# 소진공 (SEMAS) AI 챗봇 IntelliJ 플러그인

## 📝 개요

**소진공 AI 챗봇 플러그인**은 IntelliJ IDEA 개발 환경에 통합되어 개발자의 생산성 향상을 돕는 AI 기반 챗봇 도구입니다. 사용자는 이 플러그인을 통해 코드에 대해 질문하고, 코드 분석을 요청하며, 코드 수정 및 리팩토링 제안을 받을 수 있습니다.

이 플러그인은 [LM Studio](https://lmstudio.ai/)와 같이 로컬 환경에서 실행되는 LLM(거대 언어 모델) 서버와 연동하여 동작하도록 설계되었습니다.

## ✨ 주요 기능

* **🤖 대화형 AI 챗봇**: 툴 윈도우 내에서 AI 챗봇과 자유롭게 대화할 수 있습니다.
* **코드 분석 및 질의응답**: 에디터에서 분석하고 싶은 코드를 선택하고, 해당 코드에 대한 설명을 요청하거나 질문할 수 있습니다.
* **코드 수정 및 리팩토링**: "이 코드에 주석을 추가해 줘" 또는 "이 함수를 개선해 줘" 와 같이 자연어 명령을 통해 코드 수정을 요청할 수 있습니다.
    * 선택된 코드 조각에 대한 수정은 물론, 파일 전체의 코드를 분석하여 필요한 변경점을 제안받을 수 있습니다.
* **사용자 정의 시스템 프롬프트**: 'Prompt' 버튼을 통해 AI의 역할(예: "너는 Java 전문가야.")과 응답 스타일을 사용자가 직접 설정할 수 있습니다.
* **에디터 연동**: 에디터의 컨텍스트 메뉴(마우스 오른쪽 클릭)를 통해 선택한 코드를 즉시 챗봇으로 전송하여 분석을 요청할 수 있습니다.

## 🛠️ 아키텍처 및 소스 코드 분석

이 플러그인은 다음과 같은 주요 컴포넌트로 구성되어 있습니다.

| 파일명                          | 설명                                                                                                                                                             |
| ------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `LLMChatToolWindowFactory.kt`   | **UI 팩토리**: IntelliJ 툴 윈도우(`소진공 챗봇(개발자전용)`)의 UI를 생성하고 초기화합니다. 채팅 로그, 입력 필드, 전송/초기화/프롬프트 버튼 등을 배치하고 이벤트 리스너를 설정합니다. |
| `ChatService.kt`                | **핵심 로직 서비스**: 플러그인의 두뇌 역할을 하는 프로젝트 레벨 서비스입니다. LLM과의 통신, UI 업데이트, 사용자 입력 유형(질문, 지시, 일반) 분류 및 프롬프트 생성을 담당합니다. |
| `LmStudioClient.kt`             | **API 클라이언트**: `OkHttp`를 사용하여 LM Studio API 서버와 통신합니다. 채팅 완료(Chat Completions) API 엔드포인트(`v1/chat/completions`)로 요청을 보내고 응답을 받아옵니다.         |
| `SendSelectionToChatAction.kt`  | **에디터 액션**: 에디터에서 텍스트를 선택하고 마우스 오른쪽 버튼을 클릭했을 때 나타나는 메뉴 액션을 정의합니다. 선택된 텍스트를 `ChatService`로 전달하는 역할을 합니다.       |
| `CustomButtonRenderer.kt`       | **커스텀 UI 렌더러**: 에디터 내에 'Apply' / 'Reject'와 같은 버튼을 인레이(Inlay) 형태로 렌더링하는 컴포넌트입니다. (현재는 시각적 표현만 구현됨)                                   |

### 워크플로우

1.  **UI 생성**: 사용자가 툴 윈도우를 열면 `LLMChatToolWindowFactory`가 UI를 구성하고 `ChatService`에 UI 컴포넌트(JTextArea, JLabel 등)의 참조를 전달합니다.
2.  **사용자 입력**:
    * **일반 채팅**: 사용자가 툴 윈도우 하단의 입력 필드에 메시지를 입력하고 'Send' 버튼을 누릅니다.
    * **코드 분석**: 에디터에서 코드를 선택한 후, 컨텍스트 메뉴에서 액션을 실행합니다.
3.  **서비스 호출**: UI 또는 액션에서 발생한 이벤트는 `ChatService`의 메서드(`sendChatRequestToLLM`, `sendCodeToLLM`)를 호출합니다.
4.  **입력 분류 및 프롬프트 생성**: `ChatService`는 사용자 입력의 의도(질문, 지시, 일반)와 컨텍스트(코드 선택 여부)를 파악하여 LLM에 전달할 최적의 프롬프트를 동적으로 생성합니다.
5.  **API 요청**: `ChatService`는 `LmStudioClient`를 통해 구성된 프롬프트를 LM Studio 서버로 전송합니다. 요청 중에는 '로딩 중...' 인디케이터가 표시됩니다.
6.  **응답 처리 및 UI 업데이트**: `LmStudioClient`가 서버로부터 응답을 받으면 `ChatService`는 해당 응답을 챗봇 UI에 표시합니다. 모든 UI 업데이트는 `SwingWorker`와 `ApplicationManager.getApplication().invokeLater`를 통해 안전한 스레드에서 처리됩니다.

## ⚙️ 설치 및 설정

1.  **플러그인 설치**:
    * (방법 1) `Settings` > `Plugins` > `Marketplace`에서 "소진공 AI 챗봇"을 검색하여 설치합니다. (배포 시)
    * (방법 2) 이 프로젝트를 빌드하여 생성된 `jar` 파일을 `Settings` > `Plugins` > ⚙️ > `Install Plugin from Disk...`를 통해 직접 설치합니다.
2.  **LLM 서버 실행**:
    * [LM Studio](https://lmstudio.ai/) 또는 OpenAI API와 호환되는 다른 LLM 서버 프로그램을 실행합니다.
    * 서버에서 원하는 모델(예: `Llama-3`, `GPT-4`)을 로드합니다.
    * **LM Studio의 경우, 'Local Server' 탭에서 서버를 시작합니다.**
3.  **API 엔드포인트 설정**:
    * 플러그인은 기본적으로 `http://192.168.18.52:1234/v1` 주소로 요청을 보냅니다.
    * 만약 로컬 LLM 서버의 주소가 다르다면 `LmStudioClient.kt` 파일의 `baseUrl` 변수 값을 실제 서버 주소로 수정한 후 플러그인을 다시 빌드해야 합니다.
      ```kotlin
      // LmStudioClient.kt
      class LmStudioClient(
          private val baseUrl: String = "http://YOUR_LOCAL_IP:1234/v1" // 이 부분을 수정하세요.
      )
      ```

## 🚀 사용 방법

1.  **챗봇 창 열기**: IntelliJ IDEA의 우측 툴바에서 `소진공 챗봇(개발자전용)` 탭을 클릭하여 챗봇 창을 엽니다.
2.  **일반 대화**: "안녕하세요"와 같은 일반적인 메시지를 입력하고 `Send` 버튼을 클릭하거나 `Enter` 키를 누릅니다.
3.  **코드 분석 요청**:
    * 에디터에서 분석하고 싶은 코드 블록을 드래그하여 선택합니다.
    * 선택한 코드 위에서 마우스 오른쪽 버튼을 클릭합니다.
    * 나타나는 메뉴에서 `SendSelectionToChatAction`에 해당하는 항목(예: "챗봇으로 선택 영역 보내기")을 클릭합니다.
    * 챗봇 창이 활성화되며 선택한 코드가 전송되고, AI의 분석이 시작됩니다.
4.  **코드 관련 질문/수정 요청**:
    * 챗봇 창의 입력 필드에 "이 코드는 어떤 역할을 해?" 또는 "이 코드에 대한 테스트 코드를 작성해 줘"와 같이 구체적인 요청을 입력하고 전송합니다. `ChatService`는 열려있는 파일의 코드 또는 선택된 코드를 컨텍스트로 함께 고려하여 답변을 생성합니다.
5.  **시스템 프롬프트 변경**:
    * 챗봇 창 상단의 `Prompt` 버튼을 클릭합니다.
    * 나타나는 다이얼로그에서 AI의 역할과 응답 규칙을 자유롭게 수정한 후 `OK` 버튼을 누릅니다.
6.  **대화 초기화**:
    * `Reset` 버튼을 클릭하여 현재까지의 대화 내용을 모두 지우고 초기 상태로 돌아갑니다.