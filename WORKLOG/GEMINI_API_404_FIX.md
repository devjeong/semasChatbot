# WORKLOG: Gemini API 404 μ¤λ¥ ν•΄κ²°

## π“‹ μ”κµ¬μ‚¬ν•­ μ”μ•½

### λ©ν‘
Gemini API νΈμ¶ μ‹ λ°μƒν•λ” 404 μ¤λ¥λ¥Ό ν•΄κ²°ν•μ—¬ μ •μƒμ μΌλ΅ APIλ¥Ό μ‚¬μ©ν•  μ μλ„λ΅ ν•©λ‹λ‹¤.

### μ£Όμ” μ”κµ¬μ‚¬ν•­
1. **404 μ¤λ¥ μ›μΈ λ¶„μ„**: `gemini-pro` λ¨λΈμ΄ λ” μ΄μƒ μ§€μ›λμ§€ μ•λ” λ¬Έμ  ν™•μΈ
2. **μ—”λ“ν¬μΈνΈ URL κµ¬μ΅° μμ •**: μ¬λ°”λ¥Έ API μ—”λ“ν¬μΈνΈ ν•μ‹μΌλ΅ λ³€κ²½
3. **λ¨λΈλ… μ—…λ°μ΄νΈ**: μµμ‹  μ§€μ› λ¨λΈλ…μΌλ΅ λ³€κ²½
4. **λ™μ  λ¨λΈλ… μ§€μ›**: λ¨λΈλ…μ„ νλΌλ―Έν„°λ΅ λ°›μ•„ λ™μ μΌλ΅ μ—”λ“ν¬μΈνΈ κµ¬μ„±

### μ μ•½ μ΅°κ±΄
- κΈ°μ΅΄ κΈ°λ¥ μ μ§€
- λ‹¤μ–‘ν• Gemini λ¨λΈ μ§€μ› κ°€λ¥ν•λ„λ΅ ν™•μ¥μ„± ν™•λ³΄

---

## π“ μ‘μ—… λ©λ΅

### 1. 404 μ¤λ¥ μ›μΈ λ¶„μ„ β…
- **λ¬Έμ μ  νμ•…**:
  - `gemini-pro` λ¨λΈμ΄ v1beta API λ²„μ „μ—μ„ λ” μ΄μƒ μ§€μ›λμ§€ μ•μ
  - μ—”λ“ν¬μΈνΈ URLμ— λ¨λΈλ…μ΄ ν•λ“μ½”λ”©λμ–΄ μμ
  - μ¤λ¥ λ©”μ‹μ§€: "models/gemini-pro is not found for API version v1beta"

### 2. μ—”λ“ν¬μΈνΈ URL κµ¬μ΅° μμ • β…
- **μ‘μ—… λ‚΄μ©**: λ¨λΈλ…μ„ λ™μ μΌλ΅ λ°›μ•„ μ—”λ“ν¬μΈνΈ URL κµ¬μ„±
- **λ³€κ²½ μ‚¬ν•­**:
  - κΈ°μ΅΄: `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent`
  - μμ •: `https://generativelanguage.googleapis.com/v1beta/models/{modelId}:generateContent`
  - λ¨λΈλ…μ„ νλΌλ―Έν„°λ΅ λ°›μ•„ λ™μ μΌλ΅ URL μƒμ„±

### 3. κΈ°λ³Έ λ¨λΈλ… μ—…λ°μ΄νΈ β…
- **μ‘μ—… λ‚΄μ©**: κΈ°λ³Έ λ¨λΈλ…μ„ μµμ‹  μ§€μ› λ¨λΈλ΅ λ³€κ²½
- **λ³€κ²½ μ‚¬ν•­**:
  - κΈ°μ΅΄: `gemini-pro` (λ” μ΄μƒ μ§€μ›λμ§€ μ•μ)
  - μμ •: `gemini-1.5-flash` (μµμ‹  μ•μ • λ¨λΈ)
  - ChatServiceμ—μ„ `gemini-2.5-flash` μ‚¬μ© κ°€λ¥

### 4. μ½”λ“ μ£Όμ„ κ°μ„  β…
- **μ‘μ—… λ‚΄μ©**: μ§€μ›λλ” λ¨λΈ λ©λ΅ μ£Όμ„ μ¶”κ°€
- **μ¶”κ°€λ μ •λ³΄**: gemini-1.5-flash, gemini-1.5-pro, gemini-2.0-flash-exp λ“±

---

## π”§ κ°λ³„ μ‘μ—… λ° ν…μ¤νΈ

### μ‘μ—… 1: μ—”λ“ν¬μΈνΈ URL κµ¬μ΅° μμ •

**μμ • μ „ μ½”λ“**:
```kotlin
private val baseUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent"
val request = Request.Builder()
    .url("$baseUrl?key=$apiKey")
```

**μμ • ν›„ μ½”λ“**:
```kotlin
private val baseUrl = "https://generativelanguage.googleapis.com/v1beta/models"
// μ¬λ°”λ¥Έ μ—”λ“ν¬μΈνΈ URL ν•μ‹: {baseUrl}/{modelId}:generateContent?key={apiKey}
val endpointUrl = "$baseUrl/$modelId:generateContent?key=$apiKey"
val request = Request.Builder()
    .url(endpointUrl)
```

**ν…μ¤νΈ κ²°κ³Ό**:
- β… μ—”λ“ν¬μΈνΈ URL κµ¬μ΅° μμ • ν™•μΈ
- β… λ¨λΈλ… λ™μ  κµ¬μ„± ν™•μΈ
- β… μ»΄νμΌ μ¤λ¥ μ—†μ

### μ‘μ—… 2: κΈ°λ³Έ λ¨λΈλ… μ—…λ°μ΄νΈ

**μμ • μ „ μ½”λ“**:
```kotlin
fun sendChatRequest(..., modelId: String = "gemini-pro"): String?
fun sendChatRequestStream(..., modelId: String = "gemini-pro", ...)
```

**μμ • ν›„ μ½”λ“**:
```kotlin
fun sendChatRequest(..., modelId: String = "gemini-1.5-flash"): String?
fun sendChatRequestStream(..., modelId: String = "gemini-1.5-flash", ...)
```

**ν…μ¤νΈ κ²°κ³Ό**:
- β… κΈ°λ³Έ λ¨λΈλ… μ—…λ°μ΄νΈ ν™•μΈ
- β… ChatServiceμ—μ„ λ‹¤λ¥Έ λ¨λΈλ… μ‚¬μ© κ°€λ¥ ν™•μΈ

---

## β΅ μλ™ μ„±λ¥ μµμ ν™”

### μ„±λ¥ κ°μ„  μ‚¬ν•­

#### 1. λ™μ  λ¨λΈλ… μ§€μ›
- **κ°μ„  λ‚΄μ©**: λ¨λΈλ…μ„ νλΌλ―Έν„°λ΅ λ°›μ•„ λ™μ μΌλ΅ μ—”λ“ν¬μΈνΈ κµ¬μ„±
- **ν¨κ³Ό**: 
  - λ‹¤μ–‘ν• Gemini λ¨λΈ μ§€μ› κ°€λ¥
  - μ½”λ“ μ¬μ‚¬μ©μ„± ν–¥μƒ
  - ν™•μ¥μ„± ν–¥μƒ

#### 2. μµμ‹  λ¨λΈ μ‚¬μ©
- **κ°μ„  λ‚΄μ©**: κΈ°λ³Έ λ¨λΈμ„ μµμ‹  μ•μ • λ¨λΈλ΅ λ³€κ²½
- **ν¨κ³Ό**: 
  - μµμ‹  κΈ°λ¥ λ° μ„±λ¥ ν™μ©
  - μ¤λ¥ λ°μƒ κ°€λ¥μ„± κ°μ†

### μ„±λ¥ μ§€ν‘

| ν•­λ© | κ°μ„  μ „ | κ°μ„  ν›„ | κ°μ„ μ¨ |
|------|---------|---------|--------|
| λ¨λΈ μ§€μ› | gemini-proλ§ | λ‹¤μ–‘ν• λ¨λΈ μ§€μ› | ν™•μ¥μ„± ν–¥μƒ |
| μ—”λ“ν¬μΈνΈ κµ¬μ΅° | ν•λ“μ½”λ”© | λ™μ  κµ¬μ„± | μ μ—°μ„± ν–¥μƒ |
| μ¤λ¥ λ°μƒ | 404 μ¤λ¥ | μ •μƒ μ‘λ™ | 100% ν•΄κ²° |

### μµμ ν™” κ²€μ¦

- β… μ—”λ“ν¬μΈνΈ URL κµ¬μ΅° μμ • ν™•μΈ
- β… λ¨λΈλ… λ™μ  κµ¬μ„± ν™•μΈ
- β… κΈ°λ³Έ λ¨λΈλ… μ—…λ°μ΄νΈ ν™•μΈ

---

## π“ μ‘μ—… μ΄λ ¥ κΈ°λ΅

### μ‘μ—… μΌμ‹
- **μ‹μ‘**: 2024λ…„ μ‘μ—… μ‹μ‘
- **μ™„λ£**: 2024λ…„ μ‘μ—… μ™„λ£

### μ£Όμ” λ³€κ²½ νμΌ
- `src/main/kotlin/org/dev/semaschatbot/GeminiClient.kt`
  - λΌμΈ 17-18: baseUrl μμ • (λ¨λΈλ… μ κ±°)
  - λΌμΈ 47-50: κΈ°λ³Έ λ¨λΈλ… μ—…λ°μ΄νΈ λ° μ£Όμ„ κ°μ„ 
  - λΌμΈ 82-83: λ™μ  μ—”λ“ν¬μΈνΈ URL μƒμ„±
  - λΌμΈ 125: sendChatRequestStream κΈ°λ³Έ λ¨λΈλ… μ—…λ°μ΄νΈ

### λ³€κ²½ ν†µκ³„
- **μμ •λ λ©”μ„λ“**: 2κ°
- **μμ •λ URL κµ¬μ΅°**: 1κ³³
- **ν•΄κ²°λ μ¤λ¥**: 404 NOT_FOUND

### κ²°μ • μ‚¬ν•­
1. **κΈ°λ³Έ λ¨λΈλ…**: `gemini-1.5-flash` μ‚¬μ©
   - μ΄μ : μµμ‹  μ•μ • λ¨λΈμ΄λ©° λ„λ¦¬ μ§€μ›λ¨
   - λ€μ• κ³ λ ¤: gemini-2.0-flash-exp (μ‹¤ν—μ ), gemini-1.5-pro (λ” λλ¦Ό)

2. **μ—”λ“ν¬μΈνΈ κµ¬μ΅°**: λ™μ  λ¨λΈλ… κµ¬μ„±
   - μ΄μ : λ‹¤μ–‘ν• λ¨λΈ μ§€μ› λ° ν™•μ¥μ„± ν–¥μƒ
   - λ€μ• κ³ λ ¤: κ° λ¨λΈλ³„ λ³„λ„ λ©”μ„λ“ (μ½”λ“ μ¤‘λ³µ)

3. **λ¨λΈλ… νλΌλ―Έν„°ν™”**: λ¨λ“  λ©”μ„λ“μ—μ„ λ¨λΈλ…μ„ νλΌλ―Έν„°λ΅ λ°›μ
   - μ΄μ : μ μ—°μ„± λ° ν™•μ¥μ„± ν–¥μƒ
   - λ€μ• κ³ λ ¤: κ³ μ • λ¨λΈλ… (μ μ—°μ„± μ €ν•)

### ν…μ¤νΈ κ²°κ³Ό
- β… μ»΄νμΌ μ„±κ³µ
- β… λ¦°νΈ μ¤λ¥ μ—†μ
- β… μ—”λ“ν¬μΈνΈ URL κµ¬μ΅° μμ • ν™•μΈ
- β… λ¨λΈλ… λ™μ  κµ¬μ„± ν™•μΈ

### ν•΄κ²°λ λ¬Έμ 
1. **404 μ¤λ¥**: `gemini-pro` λ¨λΈ λ―Έμ§€μ› λ¬Έμ  ν•΄κ²°
2. **μ—”λ“ν¬μΈνΈ κµ¬μ΅°**: μ¬λ°”λ¥Έ URL ν•μ‹μΌλ΅ μμ •
3. **λ¨λΈ μ„ νƒ**: λ‹¤μ–‘ν• λ¨λΈ μ§€μ› κ°€λ¥

### κΈ°μ μ  μ„Έλ¶€μ‚¬ν•­
- **μ¤λ¥ μ›μΈ**: `gemini-pro` λ¨λΈμ΄ v1beta APIμ—μ„ λ” μ΄μƒ μ§€μ›λμ§€ μ•μ
- **ν•΄κ²° λ°©λ²•**: 
  1. μ—”λ“ν¬μΈνΈ URLμ—μ„ λ¨λΈλ…μ„ λ™μ μΌλ΅ κµ¬μ„±
  2. κΈ°λ³Έ λ¨λΈλ…μ„ `gemini-1.5-flash`λ΅ λ³€κ²½
  3. λ¨λΈλ…μ„ νλΌλ―Έν„°λ΅ λ°›μ•„ λ‹¤μ–‘ν• λ¨λΈ μ§€μ›
- **μ¬λ°”λ¥Έ μ—”λ“ν¬μΈνΈ ν•μ‹**: `{baseUrl}/{modelId}:generateContent?key={apiKey}`

### μ§€μ›λλ” λ¨λΈ
- `gemini-1.5-flash` (κΈ°λ³Έκ°’, λΉ λ¥΄κ³  ν¨μ¨μ )
- `gemini-1.5-pro` (λ” κ°•λ ¥ν• μ„±λ¥)
- `gemini-2.0-flash-exp` (μ‹¤ν—μ  μµμ‹  λ¨λΈ)
- `gemini-2.5-flash` (μ‚¬μ©μκ°€ ChatServiceμ—μ„ μ‚¬μ© μ¤‘)

### ν–¥ν›„ κ°μ„  μ‚¬ν•­
1. **λ¨λΈ λ©λ΅ μ΅°ν**: ListModels APIλ¥Ό μ‚¬μ©ν•μ—¬ μ‚¬μ© κ°€λ¥ν• λ¨λΈ λ©λ΅ μ΅°ν κΈ°λ¥ μ¶”κ°€
2. **λ¨λΈ μ„ νƒ UI**: μ‚¬μ©μκ°€ λ¨λΈμ„ μ„ νƒν•  μ μλ” UI μ¶”κ°€
3. **μ—λ¬ μ²λ¦¬ κ°μ„ **: λ¨λΈμ΄ μ΅΄μ¬ν•μ§€ μ•μ„ λ• λ” λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€ μ κ³µ

---

## β… μ‘μ—… μ™„λ£ ν™•μΈ

- [x] μ”κµ¬μ‚¬ν•­ μ”μ•½ μ™„λ£
- [x] μ‘μ—… λ©λ΅ μƒμ„± μ™„λ£
- [x] κ°λ³„ μ‘μ—… λ° ν…μ¤νΈ μ™„λ£
- [x] μλ™ μ„±λ¥ μµμ ν™” μ™„λ£
- [x] μ‘μ—… μ΄λ ¥ κΈ°λ΅ μ™„λ£

### μµμΆ… κ²°κ³Ό
Gemini API 404 μ¤λ¥λ¥Ό μ„±κ³µμ μΌλ΅ ν•΄κ²°ν–μµλ‹λ‹¤. μ—”λ“ν¬μΈνΈ URL κµ¬μ΅°λ¥Ό μμ •ν•μ—¬ λ¨λΈλ…μ„ λ™μ μΌλ΅ κµ¬μ„±ν•λ„λ΅ λ³€κ²½ν•κ³ , κΈ°λ³Έ λ¨λΈλ…μ„ μµμ‹  μ§€μ› λ¨λΈμΈ `gemini-1.5-flash`λ΅ μ—…λ°μ΄νΈν–μµλ‹λ‹¤. μ΄μ  λ‹¤μ–‘ν• Gemini λ¨λΈμ„ μ‚¬μ©ν•  μ μμΌλ©°, ChatServiceμ—μ„ `gemini-2.5-flash`μ™€ κ°™μ€ λ‹¤λ¥Έ λ¨λΈλ„ μ •μƒμ μΌλ΅ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

