# 회원가입/로그인 API 연동 작업 이력

## 📋 작업 개요

**작업 일시**: 2024년 (작업 수행 시점)  
**작업 목적**: 로그인 기능 고도화 - 서버 기반 회원가입/로그인 API 연동  
**서버 정보**: `http://192.168.18.53:5000`

---

## 1. 요구사항 요약

### 사용자 요구사항
1. **회원가입 기능**: 회원가입 시 회원정보를 서버(192.168.18.53:5000)로 전송하는 API 필요
2. **로그인 기능**: 로그인 시 서버의 회원정보와 비교하여 결과값을 받아서 로그인 처리하는 API 필요

### 기술 요구사항
- 클라이언트(로컬PC): Kotlin 기반 IntelliJ 플러그인
- 서버: RESTful API 엔드포인트 제공
- 통신 프로토콜: HTTP/JSON
- 보안: 비밀번호 해시 처리 (서버 측)

### 제약 조건
- 기존 로컬 SQLite 데이터베이스와의 호환성 유지
- 네트워크 오류 시 적절한 에러 처리 필요
- 성능 최적화 고려 (연결 풀링, 타임아웃 설정)

---

## 2. 작업 목록 및 진행 상황

### 2.1 클라이언트 작업 가이드 문서 작성
- **상태**: ✅ 완료
- **파일**: `WORKLOG/CLIENT_AUTH_API_GUIDE.md`
- **내용**:
  - HTTP 클라이언트 유틸리티 클래스 (`AuthApiClient`) 설계
  - 회원가입 API 연동 방법
  - 로그인 API 연동 방법
  - 테스트 방법 및 주의사항

### 2.2 서버 API 작성 가이드 문서 작성
- **상태**: ✅ 완료
- **파일**: `WORKLOG/SERVER_AUTH_API_GUIDE.md`
- **내용**:
  - 데이터베이스 스키마 설계 (MySQL, PostgreSQL, SQLite)
  - Python Flask 구현 예시
  - Node.js Express 구현 예시
  - API 엔드포인트 스펙 및 테스트 방법
  - 보안 고려사항

### 2.3 작업 이력 기록
- **상태**: ✅ 진행 중
- **파일**: `WORKLOG/AUTH_API_INTEGRATION_WORKLOG.md` (본 문서)

---

## 3. 설계 결정 사항

### 3.1 API 엔드포인트 설계

#### 회원가입 API
- **엔드포인트**: `POST /api/auth/register`
- **요청 본문**:
  ```json
  {
    "username": "사용자 아이디",
    "password": "비밀번호 (평문)",
    "name": "사용자 이름",
    "role": "USER" (선택사항)
  }
  ```
- **응답 형식**:
  ```json
  {
    "success": true/false,
    "message": "응답 메시지"
  }
  ```

#### 로그인 API
- **엔드포인트**: `POST /api/auth/login`
- **요청 본문**:
  ```json
  {
    "username": "사용자 아이디",
    "password": "비밀번호 (평문)"
  }
  ```
- **응답 형식**:
  ```json
  {
    "success": true/false,
    "message": "응답 메시지",
    "user": { 사용자 정보 } (성공 시에만)
  }
  ```

### 3.2 보안 설계

1. **비밀번호 해시**
   - 서버 측에서 bcrypt를 사용하여 비밀번호 해시 처리
   - 클라이언트는 평문 비밀번호를 전송 (HTTPS 사용 권장)

2. **SQL Injection 방지**
   - Prepared Statement 사용
   - 입력 데이터 검증 및 이스케이프 처리

3. **에러 처리**
   - 상세한 에러 정보 노출 방지
   - 일반적인 메시지만 반환

### 3.3 성능 최적화

1. **HTTP 클라이언트**
   - OkHttp3 연결 풀링 사용
   - 타임아웃 설정 (연결: 10초, 읽기: 30초, 쓰기: 10초)

2. **데이터베이스**
   - 인덱스 생성 (username, is_active)
   - 연결 풀링 (서버 측)

3. **비동기 처리**
   - Kotlin Coroutines 사용 (클라이언트)
   - 비동기 I/O 처리 (서버)

---

## 4. 구현 상세 내용

### 4.1 클라이언트 구현

#### AuthApiClient 클래스
- **위치**: `src/main/kotlin/org/dev/semaschatbot/AuthApiClient.kt` (가이드 문서에 포함)
- **주요 기능**:
  - `registerUser()`: 회원가입 요청 전송
  - `login()`: 로그인 요청 전송
  - `testConnection()`: 서버 연결 테스트

#### UserService 수정
- **회원가입 메서드 수정**:
  - 서버 API 호출 추가
  - 서버 저장 성공 후 로컬 DB에도 저장 (옵션)
  
- **로그인 메서드 수정**:
  - 서버 API 호출 추가
  - 서버 인증 성공 시 로컬 DB 동기화

### 4.2 서버 구현

#### 데이터베이스 스키마
- 사용자 테이블 생성
- 인덱스 설정 (성능 최적화)
- 제약 조건 설정 (UNIQUE, CHECK)

#### API 엔드포인트
- 회원가입 엔드포인트 (`/api/auth/register`)
- 로그인 엔드포인트 (`/api/auth/login`)
- 헬스 체크 엔드포인트 (`/api/auth/health`)

---

## 5. 테스트 계획

### 5.1 클라이언트 테스트

#### 단위 테스트
- [ ] `AuthApiClient.registerUser()` 테스트
- [ ] `AuthApiClient.login()` 테스트
- [ ] 네트워크 오류 처리 테스트
- [ ] 타임아웃 처리 테스트

#### 통합 테스트
- [ ] 회원가입 플로우 테스트
- [ ] 로그인 플로우 테스트
- [ ] 서버 연결 실패 시나리오 테스트

### 5.2 서버 테스트

#### API 테스트
- [ ] 회원가입 API 테스트 (cURL 또는 Postman)
- [ ] 로그인 API 테스트
- [ ] 중복 아이디 처리 테스트
- [ ] 잘못된 비밀번호 처리 테스트
- [ ] 비활성화 계정 처리 테스트

#### 보안 테스트
- [ ] SQL Injection 공격 테스트
- [ ] 비밀번호 해시 검증 테스트
- [ ] 입력 데이터 검증 테스트

---

## 6. 성능 개선 사항

### 6.1 클라이언트 최적화

1. **HTTP 클라이언트 설정**
   - 연결 풀링 활성화
   - 적절한 타임아웃 설정
   - 재시도 로직 추가 (선택사항)

2. **에러 처리 개선**
   - 네트워크 오류 시 자동 재시도
   - 사용자 친화적인 에러 메시지

3. **로컬 DB 동기화**
   - 서버 저장 성공 후 로컬에도 저장
   - 오프라인 지원 가능

### 6.2 서버 최적화

1. **데이터베이스 최적화**
   - 인덱스 생성으로 조회 성능 향상
   - 연결 풀링으로 연결 관리 효율화

2. **비밀번호 해시 최적화**
   - bcrypt 라운드 수 조정 (보안 vs 성능)
   - 비동기 해시 처리 (선택사항)

3. **Rate Limiting**
   - 무차별 대입 공격 방지
   - IP 기반 또는 사용자 기반 제한

---

## 7. 향후 개선 사항

### 7.1 보안 강화
- [ ] HTTPS 적용 (프로덕션 환경)
- [ ] JWT 토큰 기반 인증 추가
- [ ] Rate Limiting 구현
- [ ] 로그인 시도 횟수 제한

### 7.2 기능 확장
- [ ] 비밀번호 변경 API
- [ ] 사용자 정보 수정 API
- [ ] 로그아웃 API (토큰 무효화)
- [ ] 세션 관리

### 7.3 모니터링 및 로깅
- [ ] API 호출 로깅
- [ ] 에러 로깅 및 알림
- [ ] 성능 모니터링

---

## 8. 문서화

### 생성된 문서
1. **CLIENT_AUTH_API_GUIDE.md**
   - 클라이언트(로컬PC) 작업 가이드
   - 구현 코드 예시 포함
   - 테스트 방법 및 주의사항

2. **SERVER_AUTH_API_GUIDE.md**
   - 서버 API 작성 가이드
   - Python Flask 및 Node.js Express 구현 예시
   - 데이터베이스 스키마 설계
   - API 스펙 및 테스트 방법

3. **AUTH_API_INTEGRATION_WORKLOG.md** (본 문서)
   - 작업 이력 기록
   - 설계 결정 사항
   - 테스트 계획 및 성능 개선 사항

---

## 9. 결론

### 완료된 작업
- ✅ 클라이언트 작업 가이드 문서 작성
- ✅ 서버 API 작성 가이드 문서 작성
- ✅ 작업 이력 기록 문서 작성

### 다음 단계
1. 클라이언트 코드 구현 (`AuthApiClient` 클래스 생성)
2. `UserService` 수정 (회원가입/로그인 메서드에 API 호출 추가)
3. 서버 API 구현 (Python Flask 또는 Node.js Express 선택)
4. 통합 테스트 수행
5. 프로덕션 배포 준비

### 참고 사항
- 모든 가이드 문서는 `WORKLOG/` 디렉토리에 저장되었습니다.
- 구현 시 각 가이드 문서를 참조하여 작업을 진행하시기 바랍니다.
- 보안 관련 사항은 프로덕션 환경에서 반드시 HTTPS를 사용하시기 바랍니다.

---

**작업 완료 일시**: 2024년 (작업 완료 시점)  
**작업자**: AI Assistant  
**검토 상태**: 대기 중

